---
date: 2024-09-25
tags:
  - ОШ-1-сайт
---
Есть два бэкенда на Nest.JS - один для dev, другой для prod окружения, но при этом используется один экземпляр Strapi, который позволяет управлять структурой сайта как для dev, так и для prod окружений.

При внесении изменений на Strapi, обновления применяются сразу к обоим окружениям, но чтобы они отобразились необходимо очистить кэш, который хранится в Redis. Сделать это можно отправив запрос GET к Nest.JS по адресу `nest/api/cache/clear`. [[Search#Очистить кэш Redis|Подробнее]].

Если запрос очистки кэша отправляется в dev окружении (https://dev.onlineschool-1.ru/), то обновляется только оно. Как только изменения будут протестированы и готовы к отправке в prod, необходимо сбросить кэш в Redis для prod окружения (https://onlineschool-1.ru/), отправив аналогичный запрос.

При необходимости внесения изменений на бэкенде Nest.JS, сначала данные обновляются в dev окружении Nest.JS, затем, если все хорошо, изменения переносятся в prod Nest.JS. После этого можно очистить кэш Redis в dev окружении, проверить как все работает, и затем уже сбросить кэш для prod, чтобы изменения вступили в силу.

При отправке запросов к Nest.JS, как правило, большая часть методов подразумевает первичный поиск данных в кэше Redis, а в случае их отсутствия, выполнение запроса к Strapi. При этом сервисы Nest.JS выполняют подготовку и сохранение полученных данных в кэш Redis.

`RedisService` поддерживает следующие методы:

- `get<T>(key: string)` - позволяет получить значение из кэша по ключу
- `set<T>(key: string, value: T, ttl?: number)` - позволяет установить значение в кэше для указанного ключа с определенным временем жизни
- `del(key: string)` - позволяет удалить значение из кэша по ключу
- `reset()` - очищает весь кэш

`StrapiService` поддерживает следующие методы:

- `get<T = any>(path: string, params?: StrapiQueryParams)` - позволяет получить данные из Strapi
- `create<T = any>(path: string, data: StrapiData)` - позволяет создать данные в Strapi
- `createWithFiles<T = any>(path: string, data: FormData)` - позволяет создать данные в Strapi и загрузить файлы
- `update<T = any>(path: string, id: string | number, data: StrapiData)` - позволяет обновить данные в Strapi
- `updateWithFiles<T = any>(path: string, id: string | number, data: FormData)` - позволяет обновить данные в Strapi и загрузить файлы