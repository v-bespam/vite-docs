---
date: 2024-09-30
tags:
  - ОШ-1-сайт
---
Контроллер предназначен для получения информации о преподавателях.

### Endpoints

Контроллер предоставляет следующие эндпоинты:

| Метод | URL                            | Описание                                                                                                                      |
| ----- | ------------------------------ | ----------------------------------------------------------------------------------------------------------------------------- |
| GET   | `nest/api/tutors/`             | [[#Получение страницы преподавателей\|Получение страницы преподавателей]]                                                     |
| GET   | `nest/api/tutors/all/`         | [[#Получение списка преподавателей для сайта\|Получение списка преподавателей для сайта]]                                     |
| GET   | `nest/api/tutors/study/all/`   | [[#Получение списка всех преподавателей для платформы обучения\|Получение списка всех преподавателей для платформы обучения]] |
| GET   | `nest/api/tutors/detail/:code` | [[#Получение подробной информации о преподавателе\|Получение подробной информации о преподавателе]]                           |

### Получение страницы преподавателей

`GET nest/api/tutors/`

*Входные данные:* отсутствуют

*Функционал:*

Выполняет поиск в кэше Redis по ключу `tutors-page-info`, если данные не найдены, подготавливает их:

1. Выполняет запрос к Strapi для получения страницы TutorsPageInfo (API ID: tutors-page-info)
2. Формирует хлебные крошки
3. Если для страницы не заполнены данные блока FreeWeekDataBlock, берет информацию со страницы Strapi FreeWeekData (API ID: free-week-data)
4. Сохраняет данные в кэш и возвращает их

*Выходные данные:* Status: `200 OK`

Возвращает объект с данными страницы TutorsPageInfo из Strapi.

### Получение списка преподавателей для сайта

`GET nest/api/tutors/all/`

*Входные данные:* отсутствуют

*Функционал:*

Выполняет поиск в кэше Redis по ключу `tutors`, если данные не найдены, выполняет запрос к Strapi для получения элементов коллекции Tutors (API ID: tutor) с сортировкой по возрастанию.

Если в Strapi для преподавателя явно указано значение ShowInSite: true, он не будет добавлен в вывод. Это необходимо для случая, когда информацию о преподавателе необходимо отображать только в административной панели.

*Выходные данные:* Status: `200 OK`

Возвращает объекты с информацией о преподавателях.

```json
{
  id: number;
  fio: string;
  about: string;
  position: string;
  published_at: string;
  created_at: string;
  updated_at: string;
  code: string;
  showInSite: boolean;
  fields: TutorFields[];
  meta?: Meta;
}
```

TutorFields:

```json
{
  id: number;
  value: string;
}
```

### Получение списка всех преподавателей для платформы обучения

`GET nest/api/tutors/study/all/`

Аналогично [[#Получить список преподавателей]] ключ Redis `tutors-study`

### Получение подробной информации о преподавателе

`GET nest/api/tutors/detail/:code`

*Входные данные:*

- В запросе должен быть передан код преподавателя - `code: string`

*Функционал:*

Выполняет поиск в кэше Redis по ключу `tutor:${code}`, если данные не найдены, подготавливает их:

1. Выполняет запрос к Strapi для получения элемента коллекции Tutors (API ID: tutor), с указанным кодом
2. Обновляет описание, добавляя к нему заголовок
3. Обновляет заголовок, добавляя к нему текст: Преподаватели "Онлайн-школы"
4. Сохраняет данные в кэш и возвращает их

В случае если преподаватель с указанным кодом не найден, выбрасывается исключение NotFoundException с сообщением "Tutor not found"

*Выходные данные:* Status: `200 OK`

Возвращает объект с информацией о преподаватели из коллекции Tutors в Strapi.