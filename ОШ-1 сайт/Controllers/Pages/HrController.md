---
date: 2024-09-30
tags:
  - ОШ-1-сайт
---
Контроллер предназначен для получения информацию о вакансиях и историях сотрудников.

### Endpoints

Контроллер предоставляет следующие эндпоинты:

| Метод | URL                                 | Описание                                                                                                        |
| ----- | ----------------------------------- | --------------------------------------------------------------------------------------------------------------- |
| GET   | `nest/api/hr/common-data/`          | [[#Получение общей информации для страницы вакансий\|Получение общей информации для страницы вакансий]]         |
| GET   | `nest/api/hr/main-page-data/`       | [[#Получение главной страницы вакансий\|Получение главной страницы вакансий]]                                   |
| GET   | `nest/api/hr/vacancies/`            | [[#Получение списка вакансий<br>\|Получение списка вакансий<br>]]                                               |
| GET   | `nest/api/hr/vacancy-detail/:id/`   | [[#Получение подробной информации о вакансии\|Получение подробной информации о вакансии]]                       |
| GET   | `nest/api/hr/interviews/`           | [[#Получение историй сотрудников\|Получение историй сотрудников]]                                               |
| GET   | `nest/api/hr/interview-detail/:id/` | [[#Получение подробной информации об истории сотрудника\|Получение подробной информации об истории сотрудника]] |

### Получение общей информации для страницы вакансий

`GET nest/api/hr/common-data/`

*Входные данные:* отсутствуют

*Функционал:*

Выполняет поиск в кэше Redis по ключу `hr-common-data`, если данные не найдены, подготавливает их: выполняет запрос к Strapi для получения блоков страницы HrCommonData (API ID: hr-common-data). Добавляет к данным свойство subjectsAndHourCosts, которое содержит элементы из коллекции SubjectAndHourCosts (API ID: subject-and-hour-cost), записывает данные в Redis и возвращает их.

*Выходные данные:* Status: `200 OK`

Возвращает объект с данными страницы HrCommonData, список предметов subjectsAndHourCosts из Strapi.

### Получение главной страницы вакансий

`GET nest/api/hr/main-page-data/`

*Входные данные:* отсутствуют

*Функционал:*

Выполняет поиск в кэше Redis по ключу `hr-main-page-data`, если данные не найдены, выполняет запрос к Strapi для получения блоков страницы HrMainPage (API ID: hr-main-page). Сохраняет полученные данные в кэш и возвращает их.

*Выходные данные:* Status: `200 OK`

Возвращает объект с данными страницы HrMainPage из Strapi.

### Получение списка вакансий

`GET nest/api/hr/vacancies/`

*Входные данные:* отсутствуют

*Функционал:*

Выполняет поиск в кэше Redis по ключу `vacancies`, если данные не найдены, выполняет запрос к Strapi для получения элементов коллекции Vacancies (API ID: vacancy), отсортированных по возрастанию, по полю `Sort`. Сохраняет полученные данные в кэш и возвращает их.

*Выходные данные:* Status: `200 OK`

Возвращает объект с данными коллекции Vacancies из Strapi.

### Получение подробной информации о вакансии

`GET nest/api/hr/vacancy-detail/:id/`

*Входные данные:*

- В запросе должен быть передан ID вакансии - `id: number`

*Функционал:*

Выполняет поиск в кэше Redis по ключу `vacancy:${id}`, если данные не найдены, выполняет запрос к Strapi для получения элемента коллекции Vacancies (API ID: vacancy), с указанным ID. Если для вакансии не заполнен блок Banner, подготавливает данные для свойства `banner` при помощи функции `vacancyBanner`, используя заголовок вакансии. Сохраняет данные в кэш Redis и возвращает их.

Если вакансия с указанным ID не была найдена выбрасывает исключение NotFoundException с сообщением об ошибке "Vacancy not found".

*Выходные данные:* Status: `200 OK`

Возвращает объект с информацией о вакансии из коллекции Vacancies.

### Получение историй сотрудников

`GET nest/api/hr/interviews/`

*Входные данные:* отсутствуют

*Функционал:*

Выполняет поиск в кэше Redis по ключу `hr-interviews`, если данные не найдены, выполняет запрос к Strapi для получения элементов коллекции HrInterviews (API ID: hr-interview), отсортированных по возрастанию, по полю `Sort`. Сохраняет полученные данные в кэш и возвращает их.

*Выходные данные:* Status: `200 OK`

Возвращает объект с данными коллекции HrInterviews из Strapi.

### Получение подробной информации об истории сотрудника

`GET nest/api/hr/interview-detail/:id/`

*Входные данные:*

- В запросе должен быть передан ID истории - `id: number`

*Функционал:*

Выполняет поиск в кэше Redis по ключу `hr-interview:${id}`, если данные не найдены, выполняет запрос к Strapi для получения элемента коллекции HrInterviews (API ID: hr-interview), с указанным ID. Если для истории не заполнен блок Banner, подготавливает данные для свойства `banner` при помощи функции `interviewBanner`, используя имя, вопросы и изображение истории. Сохраняет данные в кэш Redis и возвращает их.

Если история с указанным ID не была найдена выбрасывает исключение NotFoundException с сообщением об ошибке "Interview not found".

Выходные данные:* Status: `200 OK`

Возвращает объект с информацией об истории из коллекции HrInterviews.