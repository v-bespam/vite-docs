---
date: 2024-09-30
tags:
  - ОШ-1-сайт
---
Контроллер предназначен для передачи в Strapi данных форм на сайте.

### Endpoints

Контроллер предоставляет следующие эндпоинты:

| Метод | URL                                    | Описание                                                                                                                |
| ----- | -------------------------------------- | ----------------------------------------------------------------------------------------------------------------------- |
| POST  | `nest/api/forms/request/`              | [[#Сохранение в Strapi данных формы заявки на сайте\|Сохранение в Strapi данных формы заявки на сайте]]                 |
| POST  | `nest/api/forms/remark/`               | [[#Сохранение в Strapi данных формы обратной связи на сайте\|Сохранение в Strapi данных формы обратной связи на сайте]] |
| POST  | `nest/api/forms/buy/`                  | [[#Сохранение в Strapi данных формы записи на курс на сайте\|Сохранение в Strapi данных формы записи на курс на сайте]] |
| POST  | `nest/api/forms/course-review/`        | [[#Сохранение в Strapi нового отзыва на курс\|Сохранение в Strapi нового отзыва на курс]]                               |
| POST  | `nest/api/forms/respond-to-vacancy/`   | [[#Сохранение в Strapi нового отклика на вакансию\|Сохранение в Strapi нового отклика на вакансию]]                     |
| POST  | `nest/api/forms/recommend-to-vacancy/` | [[#Сохранение в Strapi новой рекомендации на вакансию\|Сохранение в Strapi новой рекомендации на вакансию]]             |

### Сохранение в Strapi данных формы заявки на сайте

`POST nest/api/forms/request/`

*Входные данные:*

- В тело запроса должны быть переданы следующие параметры:

| Параметр | Тип данных | Валидация    | Описание                                           |
| -------- | ---------- | ------------ | -------------------------------------------------- |
| leadName | string     | Опциональный | Название формы на сайте                            |
| name     | string     | Обязательный | Имя                                                |
| phone    | string     | Обязательный | Номер телефона                                     |
| email    | string     | Опциональный | Адрес электронной почты                            |
| company  | string     | Опциональный | Организация                                        |
| question | string     | Опциональный | Вопрос                                             |
| referer  | string     | Обязательный | Ссылка на страницу, с которой был оставлена заявка |

*Функционал:*

Отправляет в коллекцию Strapi FormRequests (API ID: form-request) данные формы на сайте, переданные в запросе.

*Выходные данные:* Status: `201 Created`

### Сохранение в Strapi данных формы обратной связи на сайте

`POST nest/api/forms/remark/`

*Входные данные:*

- В тело запроса должны быть переданы следующие параметры:

| Параметр | Тип данных | Валидация    | Описание                |
| -------- | ---------- | ------------ | ----------------------- |
| name     | string     | Обязательный | Имя                     |
| phone    | string     | Обязательный | Номер телефона          |
| email    | string     | Обязательный | Адрес электронной почты |
| text     | string     | Обязательный | Текст сообщения         |

*Функционал:*

Отправляет в коллекцию Strapi FormRemarks (API ID: form-remarks) данные формы на сайте, переданные в запросе.

*Выходные данные:* Status: `201 Created`

### Сохранение в Strapi данных формы записи на курс на сайте

`POST nest/api/forms/buy/`

*Входные данные:*

- В тело запроса должны быть переданы следующие параметры:

| Параметр | Тип данных | Валидация    | Описание                |
| -------- | ---------- | ------------ | ----------------------- |
| leadName | string     | Опциональный | Название формы на сайте |
| name     | string     | Обязательный | Имя                     |
| phone    | string     | Обязательный | Номер телефона          |
| email    | string     | Опциональный | Адрес электронной почты |
| company  | string     | Опциональный | Организация             |
| question | string     | Опциональный | Вопрос                  |
| course   | number     | Обязательный | ID курса                |

*Функционал:*

Отправляет в коллекцию Strapi BuyRequests (API ID: buy-request) данные формы на сайте, переданные в запросе.

*Выходные данные:* Status: `201 Created`

### Сохранение в Strapi нового отзыва на курс

`POST nest/api/forms/course-review/`

*Входные данные:*

- В тело запроса должны быть переданы следующие параметры:

| Параметр      | Тип данных | Валидация    | Описание                                      |
| ------------- | ---------- | ------------ | --------------------------------------------- |
| name          | string     | Обязательный | Имя                                           |
| text          | string     | Обязательный | Текст отзыва                                  |
| starsCount    | number     | Обязательный | Количество звезд                              |
| course_review | number     | Опциональный | ID отзыва, к которому добавляется новый ответ |
| course        | number     | Опциональный | ID курса                                      |

*Функционал:*

При помощи RequestPayload получает `fingerprint.hash` пользователя и проверяет имеет ли он право оставлять отзывы. Для нового отзыва устанавливает значения свойства `published_at: null` чтобы в Strapi его статус был установлен как "Черновик".

Отправляет в коллекцию Strapi CourseReviews (API ID: course-review) данные формы на сайте, переданные в запросе. В случае, если в запросе было передано изображение, создает поток чтения из файла и передает его с оригинальным названием. Максимальный объем файла 10 Мб.

*Выходные данные:* Status: `201 Created`

### Сохранение в Strapi нового отклика на вакансию

`POST nest/api/forms/respond-to-vacancy/`

*Входные данные:*

- В тело запроса должны быть переданы следующие параметры:

| Параметр   | Тип данных | Валидация    | Описание                                                                        |
| ---------- | ---------- | ------------ | ------------------------------------------------------------------------------- |
| name       | string     | Обязательный | Имя                                                                             |
| surname    | string     | Обязательный | Фамилия                                                                         |
| phone      | string     | Обязательный | Номер телефона                                                                  |
| email      | string     | Обязательный | Адрес электронной почты                                                         |
| vacancy    | number     | Опциональный | ID вакансии                                                                     |
| subject    | number     | Опциональный | Предмет из коллекции Strapi SubjectAndHourCosts (API ID: subject-and-hour-cost) |
| resumeLink | string     | Опциональный | Ссылка на резюме                                                                |
| aboutMe    | string     | Опциональный | О заявителе                                                                     |

*Функционал:*

Отправляет в коллекцию Strapi VacancyRequests (API ID: vacancy-request) данные формы на сайте, переданные в запросе. В случае, если в запросе было передано изображение, создает поток чтения из файла и передает его с оригинальным названием. Максимальный объем файла 10 Мб.

*Выходные данные:* Status: `201 Created`

### Сохранение в Strapi новой рекомендации на вакансию

`POST nest/api/forms/recommend-to-vacancy/`

*Входные данные:*

- В тело запроса должны быть переданы следующие параметры:

| Параметр             | Тип данных | Валидация    | Описание                                                     |
| -------------------- | ---------- | ------------ | ------------------------------------------------------------ |
| name                 | string     | Обязательный | Имя соискателя                                               |
| surname              | string     | Обязательный | Фамилия соискателя                                           |
| phone                | string     | Обязательный | Номер телефона соискателя                                    |
| vacancy              | number     | Обязательный | Вакансия из коллекции Strapi Vacancies (API ID: vacancy)     |
| resumeLink           | string     | Опциональный | Ссылка на резюме соискателя                                  |
| sourceUserName       | string     | Обязательный | Имя рекомендовавшего                                         |
| sourceUserSurname    | string     | Обязательный | Фамилия рекомендовавшего                                     |
| sourceUserEmail      | string     | Обязательный | Адрес электронной почты рекомендовавшего                     |
| sourceUserPhone      | string     | Обязательный | Номер телефона рекомендовавшего                              |
| sourceUserIsEmployee | string     | Обязательный | Является ли рекомендовавший сотрудником ОШ. boolean или null |

*Функционал:*

Отправляет в коллекцию Strapi HrRecommendFormRequests (API ID: hr-recommend-form-request) данные формы на сайте, переданные в запросе. В случае, если в запросе было передано изображение, создает поток чтения из файла и передает его с оригинальным названием. Максимальный объем файла 10 Мб.

*Выходные данные:* Status: `201 Created`