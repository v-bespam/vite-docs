---
date: 2024-10-28
tags:
  - Онлайн-школа
---
# ArchiverModule

Модуль предназначен для создания ZIP-архива из набора файлов при помощи библиотеки `zlib` с уровнем сжатия 6. Модуль не предоставляет никаких эндпоинтов.

***

## ArchiverService

Предоставляет следующий метод:

| Имя           | Описание        |
| ------------- | --------------- |
| createArchive | Создание архива |

***

### createArchive

*Входные данные:*

```json
{
  name: string;
  archivePath: string;
  files: {
    name: string;
    dir: string | null;
    url?: string;
    buffer?: Buffer;
  }[];
}
```

*Функционал:*

Метод проверяет что были переданы файлы для архивирования, если их нет, сразу возвращает `null`. Создаются необходимые потоки для записи архива и инициализируется экземпляр архива с заданными параметрами.

Для каждого файла проверяется доступен он в виде буфера или по URL. Если для файла указан URL, выполняет HTTP-запрос для получения данных, которые затем преобразуются в `Buffer`. Если файл не может быть обработан, в лог выводится ошибка.

После обработки всех файлов, они сортируются по имени, и каждый файл добавляется в архив. Метод `finalize` завершает процесс создания архива, после чего возвращает его содержимое.

*Выходные данные:*

Возвращает объект `Buffer` с содержимым архива или `null`, если во время архивирования произошла ошибка.

***

## Зависимости (импортируемые модули)

- HttpModule
- UploadModule

***

## Используемый стэк

- JavaScript
- NestJS
- TypeScript
- Node.js